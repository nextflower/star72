<!DOCTYPE HTML>
<html>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>用户留言 - ${site.name} - Powered by star72</title>
        <meta http-equiv="keywords" content="用户留言"/>
        <meta http-equiv="description" content="用户留言"/>
        <!--[if lt IE 9]>
            <script src="${resSys}/html5.js" type="text/javascript"></script>
        <![endif]-->
        <link href="${base}/res/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="/${res}/css/style.css" rel="stylesheet">
        <link href="${base}/res/bootstrap/css/normalize.css" rel="stylesheet">
        <style type="text/css">
            body {
                margin: 0;
                padding: 0;
                background: url(${base}/res/images/bj.gif) top center;
                background-repeat: repeat;
            }
        </style>
    </head>
    <body style="padding:20px;">
        [#include "../include/header.html"/]<hr>
        <div class="container">
            <div class="w670">
                <div class="hundred100 mt10">
                    <div class="AreaTitle text-center wenxian"><h1>留言列表</h1></div>
                    <div class="lybCon">
                        [@cms_guestbook_page siteId=site.id count='5']
                        [#list tag_pagination.list as m]
						
							<div class="panel panel-primary">
							   <div class="panel-body">
	                                <span>${(m.member.qq)!'匿名网友'} 于${m.createTime}留言：</span>
	                                <span>[@text_cut s=m.contentHtml len=60/]</span>
	                                <div class="clear"></div>
									[#if m.replyHtml??]
	                                <span>&nbsp;管理员回复：[@text_cut s=m.replyHtml len=30/]</span>
									[/#if]
							   </div>
							</div>
                        [/#list] 
						
						<!--分页代码-->
						
                        [/@cms_guestbook_page]
                    </div>
                </div>
                <div class="clear-10">
                </div>
				
				<div class="row"><h1></h1></div>
				
                <div class="row">
                    <div class="AreaTitle wenxian text-center"><h4>发表留言</h4></div>
					<div class="panel panel-primary">
					   <div class="panel-body">
						<form id="guestbookForm" class="form-horizontal" role="form" action="${base}/guestbook.jspx" method="post">
							<input type="hidden" name="ctgId" value="1"/>
						   <div class="row">
						      <label for="qq" class="col-sm-2 control-label">昵称(必填)</label>
						      <div class="col-sm-3">
						         <input name="qq" id="qq" type="text" class="form-control" placeholder="请输入昵称">
								 <span id="qq_error"></span>
						      </div>
						   </div>
						   <div class="row"><h5></h5></div>
						    <div class="row">
							  <label for="email" class="col-sm-2 control-label">邮箱</label>
						      <div class="col-sm-4">
						         <input type="email" name="email" class="form-control" id="email" placeholder="请输入邮箱">
								 <span id="email_error"></span>
						      </div>
						   </div>
						   <div class="row"><h5></h5></div>
						   <div class="row">
						      <label for="title" class="col-sm-2 control-label">标题(必填)</label>
						      <div class="col-sm-6">
						         <input name="title" class="form-control" id="title" placeholder="请输入标题">
								 <span id="title_error"></span>
						      </div>
						   </div>
						   <div class="row"><h5></h5></div>
						   <div class="row">
							    <label for="content" class="col-sm-2 control-label">留言内容(必填)</label>
								<div class="col-sm-8">
							    	<textarea name="content" id="content" cols="130" rows="4"></textarea>
									<span id="content_error"></span>
								</div>
						  </div>
						  <div class="row"><h5></h5></div>
						   <div class="row">
						      <label for="captcha" class="col-sm-2 control-label">验证码(必填)</label>
						      <div class="col-sm-2">
						         <input name="captcha" class="form-control" id="captcha" placeholder="请输入右侧的验证码">
								 <span id="captcha_error"></span>
						      </div>
							  <div class="col-sm-2">
							  		<img src="${base}/captcha.svl" class="img-thumbnail" style="height:34px;" onclick="this.src='${base}/captcha.svl?d='+new Date()">
	                          </div>
						   </div>
						   <div class="form-group">
						      <div class="text-center">
						         <button id="submit" type="submit" class="btn btn-success">留言</button>&nbsp;
						         <button type="reset" class="btn btn-default">重置</button>
						      </div>
						   </div>
						</form>
						
					   </div>
					</div>
					
				</div>
            </div>
        </div>
        [#include "../include/footer.html"/]
        <script src="${resSys}/jquery.js">
        </script>
        <script src="${base}/res/bootstrap/js/bootstrap.min.js">
        </script>
        <script src="${resSys}/front.js" type="text/javascript">
        </script>
        <script type="text/javascript">
            $(function(){
                Cms.siteFlow("${base}", location.href, document.referrer);
                $.cookie("_site_id_cookie", "${site.id!}", {
                    path: '${base}'
                });
            });
            
            $(window).scroll(function(){
                if ($(window).scrollTop() >= 100) {
                    $(".backtop").fadeIn();
                }
                else {
                    $(".backtop").fadeOut();
                }
            });
            
            //返回顶部
            $(".backtop").click(function(event){
                $('html,body').animate({
                    scrollTop: 0
                }, 500);
                return false;
            });
			
            $(function() {
				
				$("#guestbookForm").validate( {
					  rules : {
					   qq : {
					    required : true,
					   },
					   title : {
					    required : true
					   },
					   email : {
					    email : true
					   },
					   content : {
					    required : true
					   },
					   captcha : {
					    required : true,
					    minlength : 4
					   }
					  },
					  messages : {
					   qq : {
					    required : "请输入用户昵称",
					   },
					   email : {
					    email : "请输入正确的邮箱地址"
					   },
					   title : {
					    required : "请输入标题",
					   },
					   content : {
					    required : "请输入正文"
					   },
					   captcha : {
					    required : "请输入验证码",
					    minlength : "验证码不完整",
					   }
					  },
					  errorPlacement: function(error, element) {  
							if ( element.is("input[name='qq']") ) {
								error.appendTo($('#qq')); 
							} else if ( element.is("input[name='email']") ) {
								error.appendTo($('#email')); 
							} else if ( element.is("input[name='title']") ) {
								error.appendTo($('#title')); 
							} else if ( element.is("input[name='content']") ) {
								error.appendTo($('#content')); 
							} else if ( element.is("input[name='captcha']") ) {
								error.appendTo($('#captcha')); 
							}
					},
					submitHandler:function(form){
						var options = {
		                    url: 'guestbook.jspx',
		                    type: 'post',
		                    dataType: 'json',
		                    data: $("#guestbookForm").serialize(),
		                    success:  function (data) {
			                	if(data.status==0) {
				                    alert("留言成功");
				                    location.href=location.href;
				                } else if(data.status==1) {	
				                    alert("验证码错误");
				                    $("#guestbookCaptcha").click();
				                }
		                    }
		                };
		                $.ajax(options);
						return false;
				    }  
				});
            });
            
        </script>
    </body>
</html>
